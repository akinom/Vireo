# python helper scripts 

##  split Vireo  Spreadsheet export 

To give certificate program administrators access to thesis suubmitted to their certificate program 
we kwep track of sthesis with multiple certificate program designations in a spreadsheet, export all submitted thesis and 
generate spreadsheets of submissions to each certificate program with the [vireoSpreadSheetSplt.py](vireoSpreadSheetSplt.py) script.

~~~
python vireoSpreadSheetSplit.py --help
~~~

The script requires openpyxl. It is written in Python3.6

* export all thesis in submitted and approved and reviewed state with all possible columns from Vireo to excel spreadsheet
* downlod spreadsheet with additional certificate program information: [Addional Certificate Data](https://docs.google.com/spreadsheets/d/1XsX5Z_49vJ5ze-0LNlA9UbUgDON_KUVHMqqRIapaJCM/edit#gid=0)
* mkdir  dated-dir: yyyy-mm-dd
* add [HEADER.html](HEADER.html) to directory  and adjust date in file
* cd dated-dir
* mkdir xlsx
* copy Thesis and Certificate spreadsheets to xlsx
* run script to generate files in date-dir - see command below
* move the list of tesis without a certificate program designation tp xlsx:  mv None.tsv xlsx
* tar/zip dated dir and copy to server
* ssh to server
* cd /var/www/html/CertificatePrograms/
    * unzip tar file and create dated-dir with newly generated files
    * rm latest
    * ln -s latest dated-dir
    * make sure permissions are set to be world readable:
        * chmod o+r dated-dir/*
        * chmod o+rx dated-dir
* test access with browser:; https://thesis-central.princeton.edu/CertificatePrograms/latest


generate certificate program files in the dated directory 

~~~
python ../vireoSpreadSheetSplt.py  --add_certs xlsx/AdditionalPrograms.xlsx  --thesis xlsx/Thesis.xlsx
~~~


##  import Vireo data to DataSpace 
 
This is a multi step process. Work in a dedicated directory - let's call it dspace

* export spreadsheet of all thesis in all states with all available columns - save to dspace directory -
* download spreadsheet with additional certificate program information: Addional Certificate Data and copy to dspace dir
* get latest list of restriction requests - - save to dspace directory - available a day after graduation
* enhance restriction request table with vireo IDs
* work by department/certificate program:
    * create named subdirectory in dspace/cert_program or dspace/home_dept/
    * export spreadsheet of relevant thesis in all states with all available columns - save to named subdir
    * export same thesis in dspace format - also save in named subdirectory - ADJUST Vireo EXPORTER
    * Add cover page to primary pdf
    * enhance with additional certificate information - NEED TO WRITE SCRIPT
    * enhance with restriction access where necessary (include walk in access metadata) - NEED TO WRITE SCRIPT
    * combine multi author thesis - NEED TO WRITE SCRIPT
        remember to look at restriction request on behalf of any author
    * transfer to dataspace - include spreadsheet and summary table generated by scripts
    * import into workflow - NEED TO WRITE bash script ?

Post processing
    * Map thesis with cert programs to cert program collection
        * create new collections as needed


### enhance restriction request table with vireo IDs

add empty column with header 'ID' to spreadsheet - then run enhancement script, which will do its best to find the matching subissions

~~~
python restrictionsFindIds.py -t Thesis.xlsx -r Restrictions.xlsx
~~~
    
The script goes through the restriction requests and either prints the match already chosen or offers possible matches to choose from.
At the end it prompts for a filename where to save the enhanced restrictions spreadsheet.
This process usualy matches most of the requests.
The remaining requests need to be matched manually.



### may not need do it that way 

would have to teach [vireoSpreadSheetSplit.py](../vireoSpreadSheetSplit.py)  how to read tsv files

* split submissions into several directories, one for each department and one for each certificate program: 
    *  dspace/home_dept/<DEPT_NAME> 
    *  dspace/cert_program/<CERT_NAME> 
    

split by thesis type 
~~~
python ../vireoSpreadSheetSplit.py --thesis Thesis.xlsx --all_cols --split_col 'Thesis Type'
~~~

split by home department name
~~~
python ../../vireoSpreadSheetSplit.py --thesis Certificate-Program-Thesis.tsv --all_cols --split_col 'Department' --format tsv
~~~

split by certificate program name
~~~
python ../../vireoSpreadSheetSplit.py --thesis Certificate-Program-Thesis.tsv --all_cols --split_col 'Department' --format tsv
~~~




